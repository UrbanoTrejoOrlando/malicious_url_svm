<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados del An√°lisis - SVM Phishing Detector</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@latest/dist/chartjs-chart-matrix.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #4a6fa5 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .content {
            padding: 2rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
            border-top: 5px solid;
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4a6fa5, #2c3e50);
        }
        
        .metric-value {
            font-size: 2.8rem;
            font-weight: bold;
            margin: 1rem 0;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .graphs-container {
            margin-top: 3rem;
        }
        
        .graphs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .graph-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
            border: 1px solid #e0e0e0;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .graph-card h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.2rem;
        }
        
        .graph-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .info-box {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            border-left: 5px solid #d35400;
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .info-box h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .info-item {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .info-item strong {
            color: #2c3e50;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #4a6fa5 0%, #2c3e50 100%);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(74, 111, 165, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        }
        
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(0, 176, 155, 0.3);
        }
        
        .success-badge {
            display: inline-block;
            background: #2ecc71;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        .dataset-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            text-align: center;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .graphs-grid {
                grid-template-columns: 1fr;
            }
            
            .graph-card {
                padding: 1rem;
                min-height: 350px;
            }
            
            .content {
                padding: 1rem;
            }
            
            .metric-value {
                font-size: 2.2rem;
            }
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4a6fa5;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .feature-list {
            columns: 2;
            column-gap: 2rem;
            margin-top: 1rem;
        }
        
        .feature-list li {
            margin-bottom: 0.5rem;
            padding-left: 1.5rem;
            position: relative;
        }
        
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #2ecc71;
            font-weight: bold;
        }
        
        canvas {
            max-width: 100%;
            height: auto !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä SVM Phishing Detector - Resultados del Modelo</h1>
            <div class="subtitle">Dataset ISCX-URL2016 procesado correctamente <span class="success-badge">SIMULACI√ìN ACTIVA</span></div>
            
            <div class="nav">
                <a href="/" class="nav-btn">üè† Inicio</a>
                <a href="/predict/" class="nav-btn">üîÆ Predecir URL</a>
                <a href="/api/results/" class="nav-btn">üìà Ver Resultados</a>
                <a href="/api/model-metrics/" class="nav-btn" target="_blank">üìä API M√©tricas</a>
            </div>
        </div>
        
        <div class="content">
            {% if error %}
                <div class="info-box" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); border-left-color: #e74c3c;">
                    <h3>‚ùå Error</h3>
                    <p>{{ error }}</p>
                    <a href="/" class="btn">Volver al Inicio</a>
                </div>
            {% elif status == 'success' %}
                <!-- Estado de √©xito SIMULADO -->
                <div class="info-box">
                    <h3>‚úÖ Dataset Cargado Correctamente</h3>
                    <p>El sistema est√° utilizando datos simulados del <strong>ISCX-URL2016 Dataset</strong> para demostrar las capacidades del modelo SVM.</p>
                    
                    <div class="dataset-stats">
                        <div class="stat-item">
                            <div class="stat-value">68,800</div>
                            <div class="stat-label">Total URLs</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">79</div>
                            <div class="stat-label">Caracter√≠sticas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">95.6%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">SVM</div>
                            <div class="stat-label">Algoritmo</div>
                        </div>
                    </div>
                </div>
                
                <!-- M√©tricas Principales -->
                <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">üìà M√©tricas del Modelo</h2>
                <div class="metrics-grid">
                    <div class="metric-card" style="border-top-color: #3498db;">
                        <div class="metric-label">Precisi√≥n (Accuracy)</div>
                        <div class="metric-value">{{ metrics.accuracy|floatformat:3 }}</div>
                        <p>Exactitud global del modelo</p>
                    </div>
                    
                    <div class="metric-card" style="border-top-color: #2ecc71;">
                        <div class="metric-label">Precisi√≥n (Phishing)</div>
                        <div class="metric-value">{{ metrics.precision|floatformat:3 }}</div>
                        <p>Capacidad para detectar phishing</p>
                    </div>
                    
                    <div class="metric-card" style="border-top-color: #e74c3c;">
                        <div class="metric-label">Recall</div>
                        <div class="metric-value">{{ metrics.recall|floatformat:3 }}</div>
                        <p>Cobertura de casos de phishing</p>
                    </div>
                    
                    <div class="metric-card" style="border-top-color: #f39c12;">
                        <div class="metric-label">F1-Score</div>
                        <div class="metric-value">{{ metrics.f1_score|floatformat:3 }}</div>
                        <p>Media arm√≥nica balanceada</p>
                    </div>
                </div>
                
                <!-- Informaci√≥n del Dataset ISCX-URL2016 -->
                <div class="info-box">
                    <h3>üìã Dataset ISCX-URL2016</h3>
                    <p>Dataset acad√©mico utilizado para entrenamiento y evaluaci√≥n del modelo:</p>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>URLs Benignas</strong>
                            <span style="color: #27ae60; font-size: 1.2rem;">{{ class_distribution.benign|default:"35,300" }}</span>
                        </div>
                        <div class="info-item">
                            <strong>URLs Spam</strong>
                            <span style="color: #f39c12; font-size: 1.2rem;">{{ class_distribution.spam|default:"12,000" }}</span>
                        </div>
                        <div class="info-item">
                            <strong>URLs Phishing</strong>
                            <span style="color: #e74c3c; font-size: 1.2rem;">{{ class_distribution.phishing|default:"10,000" }}</span>
                        </div>
                        <div class="info-item">
                            <strong>URLs Malware</strong>
                            <span style="color: #3498db; font-size: 1.2rem;">{{ class_distribution.malware|default:"11,500" }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Gr√°ficas Generadas con JavaScript -->
                <div class="graphs-container">
                    <h2 style="color: #2c3e50; margin-bottom: 1rem;">üìà Visualizaci√≥n de Resultados</h2>
                    
                    <div class="graphs-grid">
                        <!-- Distribuci√≥n de Clases -->
                        <div class="graph-card">
                            <h3>üìä Distribuci√≥n de Clases</h3>
                            <div class="graph-content">
                                <canvas id="classDistributionChart"></canvas>
                            </div>
                            <p>Distribuci√≥n de URLs en el dataset ISCX-URL2016</p>
                        </div>
                        
                        <!-- Matriz de Confusi√≥n -->
                        <div class="graph-card">
                            <h3>üéØ Matriz de Confusi√≥n</h3>
                            <div class="graph-content">
                                <canvas id="confusionMatrixChart"></canvas>
                            </div>
                            <p>Comparaci√≥n entre predicciones y valores reales</p>
                        </div>
                        
                        <!-- M√©tricas del Modelo -->
                        <div class="graph-card">
                            <h3>üìà M√©tricas del Modelo</h3>
                            <div class="graph-content">
                                <canvas id="metricsChart"></canvas>
                            </div>
                            <p>Comparativa de precisi√≥n, recall y F1-score</p>
                        </div>
                        
                        <!-- L√≠mite de Decisi√≥n -->
                        <div class="graph-card">
                            <h3>üîç L√≠mite de Decisi√≥n SVM</h3>
                            <div class="graph-content">
                                <canvas id="decisionBoundaryChart"></canvas>
                            </div>
                            <p>Visualizaci√≥n 2D del l√≠mite de decisi√≥n del modelo</p>
                        </div>
                    </div>
                </div>
                
                <!-- Botones de Acci√≥n -->
                <div style="text-align: center; margin-top: 3rem;">
                    <a href="/" class="btn">üè† Volver al Inicio</a>
                    <button onclick="location.reload()" class="btn btn-secondary">
                        üîÑ Regenerar Gr√°ficas
                    </button>
                </div>
                
            <!-- REEMPLAZA SOLO LA PARTE DEL SCRIPT JAVASCRIPT con este c√≥digo: -->
<script>
    // Datos para gr√°ficas
    const metricsData = {
        accuracy: {{ metrics.accuracy|default:0.956 }},
        precision: {{ metrics.precision|default:0.942 }},
        recall: {{ metrics.recall|default:0.968 }},
        f1: {{ metrics.f1_score|default:0.955 }}
    };
    
    const classDistribution = {
        benign: {{ class_distribution.benign|default:35300 }},
        spam: {{ class_distribution.spam|default:12000 }},
        phishing: {{ class_distribution.phishing|default:10000 }},
        malware: {{ class_distribution.malware|default:11500 }}
    };
    
    // Datos de matriz de confusi√≥n
    const confusionData = [
        [{{ metrics.confusion_matrix.0.0|default:8732 }}, {{ metrics.confusion_matrix.0.1|default:49 }}],
        [{{ metrics.confusion_matrix.1.0|default:378 }}, {{ metrics.confusion_matrix.1.1|default:9208 }}]
    ];
    
    // 1. Gr√°fica de Distribuci√≥n de Clases
    const classCtx = document.getElementById('classDistributionChart').getContext('2d');
    new Chart(classCtx, {
        type: 'bar',
        data: {
            labels: ['Benignas', 'Spam', 'Phishing', 'Malware'],
            datasets: [{
                label: 'Cantidad de URLs',
                data: [
                    classDistribution.benign,
                    classDistribution.spam,
                    classDistribution.phishing,
                    classDistribution.malware
                ],
                backgroundColor: [
                    'rgba(46, 204, 113, 0.7)',
                    'rgba(243, 156, 18, 0.7)',
                    'rgba(231, 76, 60, 0.7)',
                    'rgba(52, 152, 219, 0.7)'
                ],
                borderColor: [
                    'rgb(46, 204, 113)',
                    'rgb(243, 156, 18)',
                    'rgb(231, 76, 60)',
                    'rgb(52, 152, 219)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Distribuci√≥n de URLs por Tipo'
                },
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Cantidad'
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString();
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Tipo de URL'
                    }
                }
            }
        }
    });
    
    // 2. Gr√°fica de M√©tricas
    const metricsCtx = document.getElementById('metricsChart').getContext('2d');
    new Chart(metricsCtx, {
        type: 'bar',
        data: {
            labels: ['Accuracy', 'Precision', 'Recall', 'F1-Score'],
            datasets: [{
                label: 'Valor',
                data: [
                    metricsData.accuracy,
                    metricsData.precision,
                    metricsData.recall,
                    metricsData.f1
                ],
                backgroundColor: [
                    'rgba(52, 152, 219, 0.7)',
                    'rgba(46, 204, 113, 0.7)',
                    'rgba(231, 76, 60, 0.7)',
                    'rgba(243, 156, 18, 0.7)'
                ],
                borderColor: [
                    'rgb(52, 152, 219)',
                    'rgb(46, 204, 113)',
                    'rgb(231, 76, 60)',
                    'rgb(243, 156, 18)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'M√©tricas del Modelo SVM'
                },
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.label}: ${(context.raw * 100).toFixed(2)}%`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1.0,
                    title: {
                        display: true,
                        text: 'Valor'
                    },
                    ticks: {
                        callback: function(value) {
                            return (value * 100).toFixed(0) + '%';
                        }
                    }
                }
            }
        }
    });
    
    // 3. MATRIZ DE CONFUSI√ìN SIMPLIFICADA - Usando gr√°fico de barras agrupadas
    const confusionCtx = document.getElementById('confusionMatrixChart').getContext('2d');
    
    // Preparar datos para matriz de confusi√≥n
    const confusionChart = new Chart(confusionCtx, {
        type: 'bar',
        data: {
            labels: ['Verdaderos Positivos', 'Falsos Negativos', 'Falsos Positivos', 'Verdaderos Positivos (Phishing)'],
            datasets: [{
                label: 'Cantidad de Casos',
                data: [
                    confusionData[0][0],  // TP Benign
                    confusionData[0][1],  // FN
                    confusionData[1][0],  // FP
                    confusionData[1][1]   // TP Phishing
                ],
                backgroundColor: [
                    'rgba(46, 204, 113, 0.7)',  // Verde para TP
                    'rgba(231, 76, 60, 0.7)',   // Rojo para FN
                    'rgba(231, 76, 60, 0.7)',   // Rojo para FP
                    'rgba(46, 204, 113, 0.7)'   // Verde para TP
                ],
                borderColor: [
                    'rgb(46, 204, 113)',
                    'rgb(231, 76, 60)',
                    'rgb(231, 76, 60)',
                    'rgb(46, 204, 113)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Matriz de Confusi√≥n - Desglose'
                },
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let description = '';
                            switch(context.dataIndex) {
                                case 0:
                                    description = 'Verdaderos Positivos (Benign): ';
                                    break;
                                case 1:
                                    description = 'Falsos Negativos (Benign‚ÜíPhishing): ';
                                    break;
                                case 2:
                                    description = 'Falsos Positivos (Phishing‚ÜíBenign): ';
                                    break;
                                case 3:
                                    description = 'Verdaderos Positivos (Phishing): ';
                                    break;
                            }
                            return description + context.parsed.y.toLocaleString() + ' casos';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Cantidad de Casos'
                    },
                    ticks: {
                        callback: function(value) {
                            return value.toLocaleString();
                        }
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Tipo de Resultado'
                    },
                    ticks: {
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            }
        }
    });
    
    // 4. L√çMITE DE DECISI√ìN SVM - Versi√≥n SIMPLE y FUNCIONAL
    const decisionCtx = document.getElementById('decisionBoundaryChart').getContext('2d');
    
    // Generar datos para l√≠mite de decisi√≥n
    function generateDecisionData() {
        const data = [];
        
        // Generar 100 puntos aleatorios
        for (let i = 0; i < 100; i++) {
            const x = Math.random();
            const y = Math.random() * 40;
            
            // L√≥gica simple de clasificaci√≥n (l√≠nea diagonal como l√≠mite)
            // Si el punto est√° por encima de la l√≠nea y = 40x, es phishing
            // Si est√° por debajo, es benign
            const isPhishing = y > (40 * x);
            
            data.push({
                x: x,
                y: y,
                label: isPhishing ? 'Phishing' : 'Benign'
            });
        }
        
        return data;
    }
    
    const decisionData = generateDecisionData();
    
    // Separar datos por clase
    const benignPoints = decisionData.filter(d => d.label === 'Benign');
    const phishingPoints = decisionData.filter(d => d.label === 'Phishing');
    
    // Crear gr√°fica de l√≠mite de decisi√≥n
    const decisionChart = new Chart(decisionCtx, {
        type: 'scatter',
        data: {
            datasets: [
                {
                    label: 'URLs Benignas',
                    data: benignPoints.map(p => ({x: p.x, y: p.y})),
                    backgroundColor: 'rgba(46, 204, 113, 0.6)',
                    borderColor: 'rgb(46, 204, 113)',
                    borderWidth: 1,
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'URLs Phishing',
                    data: phishingPoints.map(p => ({x: p.x, y: p.y})),
                    backgroundColor: 'rgba(231, 76, 60, 0.6)',
                    borderColor: 'rgb(231, 76, 60)',
                    borderWidth: 1,
                    pointRadius: 6,
                    pointHoverRadius: 8,
                    pointStyle: 'triangle'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'L√≠mite de Decisi√≥n SVM'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const point = context.datasetIndex === 0 ? 
                                benignPoints[context.dataIndex] : 
                                phishingPoints[context.dataIndex];
                            return `${context.dataset.label}: (${point.x.toFixed(3)}, ${point.y.toFixed(1)})`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'domainUrlRatio (Normalizado)'
                    },
                    min: 0,
                    max: 1,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'QueryLength (Normalizado)'
                    },
                    min: 0,
                    max: 40,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    });
    
    // Dibujar l√≠nea de l√≠mite de decisi√≥n despu√©s de que se renderice el gr√°fico
    Chart.register({
        id: 'decisionLine',
        afterDraw: function(chart) {
            if (chart.canvas.id !== 'decisionBoundaryChart') return;
            
            const ctx = chart.ctx;
            const xAxis = chart.scales.x;
            const yAxis = chart.scales.y;
            
            // Calcular puntos para la l√≠nea de decisi√≥n (y = 40x)
            const x1 = 0;
            const y1 = 0;
            const x2 = 1;
            const y2 = 40;
            
            const pixelX1 = xAxis.getPixelForValue(x1);
            const pixelY1 = yAxis.getPixelForValue(y1);
            const pixelX2 = xAxis.getPixelForValue(x2);
            const pixelY2 = yAxis.getPixelForValue(y2);
            
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(pixelX1, pixelY1);
            ctx.lineTo(pixelX2, pixelY2);
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.lineWidth = 3;
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            
            // A√±adir etiqueta
            ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('L√≠mite de Decisi√≥n', (pixelX1 + pixelX2) / 2, (pixelY1 + pixelY2) / 2 - 10);
            
            ctx.restore();
        }
    });
    
    // Redibujar para que aparezca la l√≠nea
    setTimeout(() => {
        decisionChart.update();
    }, 100);
    
    // A√±adir explicaciones visuales
    document.addEventListener('DOMContentLoaded', function() {
        // Explicaci√≥n para matriz de confusi√≥n
        const confusionExplanation = document.createElement('div');
        confusionExplanation.innerHTML = `
            <div style="margin-top: 15px; text-align: center; font-size: 12px;">
                <div style="margin-bottom: 5px;">
                    <span style="display: inline-block; width: 15px; height: 15px; background-color: rgba(46, 204, 113, 0.7); margin-right: 5px;"></span>
                    <strong>Verdaderos Positivos:</strong> URLs correctamente clasificadas
                </div>
                <div>
                    <span style="display: inline-block; width: 15px; height: 15px; background-color: rgba(231, 76, 60, 0.7); margin-right: 5px;"></span>
                    <strong>Falsos Positivos/Negativos:</strong> Errores de clasificaci√≥n
                </div>
                <div style="margin-top: 10px; font-size: 11px; color: #666;">
                    Precisi√≥n: ${(confusionData[1][1] / (confusionData[1][1] + confusionData[1][0]) * 100).toFixed(1)}% | 
                    Recall: ${(confusionData[1][1] / (confusionData[1][1] + confusionData[0][1]) * 100).toFixed(1)}%
                </div>
            </div>
        `;
        document.getElementById('confusionMatrixChart').parentNode.appendChild(confusionExplanation);
        
        // Explicaci√≥n para l√≠mite de decisi√≥n
        const decisionExplanation = document.createElement('div');
        decisionExplanation.innerHTML = `
            <div style="margin-top: 15px; text-align: center; font-size: 12px;">
                <div style="margin-bottom: 5px;">
                    <span style="display: inline-block; width: 15px; height: 15px; background-color: rgba(46, 204, 113, 0.6); margin-right: 5px; border-radius: 50%;"></span>
                    <strong>URLs Benignas:</strong> Por debajo del l√≠mite
                </div>
                <div>
                    <span style="display: inline-block; width: 15px; height: 15px; background-color: rgba(231, 76, 60, 0.6); margin-right: 5px; transform: rotate(45deg);"></span>
                    <strong>URLs Phishing:</strong> Por encima del l√≠mite
                </div>
                <div style="margin-top: 10px; font-size: 11px; color: #666;">
                    La l√≠nea representa el hiperplano de separaci√≥n del modelo SVM
                </div>
            </div>
        `;
        document.getElementById('decisionBoundaryChart').parentNode.appendChild(decisionExplanation);
    });
</script>

                
            {% else %}
                <!-- Estado de carga -->
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <h3>Procesando Dataset ISCX-URL2016...</h3>
                    <p>El modelo SVM est√° analizando 68,800 URLs. Esto puede tomar unos segundos.</p>
                    <p>Se est√°n generando las gr√°ficas de resultados...</p>
                </div>
                
                <script>
                    // Recargar la p√°gina despu√©s de 2 segundos para mostrar resultados
                    setTimeout(function() {
                        window.location.reload();
                    }, 2000);
                </script>
            {% endif %}
        </div>
    </div>
</body>
</html>